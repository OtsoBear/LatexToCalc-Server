<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Otso Veisterä | Portfolio</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <style>
        body {
            margin: 0;
            padding: 0;
            background-color: #000;
            color: #fff;
            font-family: 'Space Mono', monospace;
            overflow-x: hidden;
            height: 400vh;
            cursor: default;
            font-size: 16px; /* Base font size for better scaling */
        }
        
        canvas {
            position: fixed;
            top: 0;
            left: 0;
            z-index: -1;
        }
        
        .section {
            position: fixed;
            width: 100%;
            height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            opacity: 0;
            transition: all 0.8s ease;
            pointer-events: none;
            z-index: 1;
            padding: 0 10px; /* Add padding for better content visibility */
            box-sizing: border-box; /* Include padding in width calculation */
        }
        
        .section.active {
            opacity: 1;
            pointer-events: all;
        }
        
        .content-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            max-width: 1200px;
            gap: 20px; /* Reduced from 30px */
            padding: 0 10px; /* Reduced from 20px */
            margin-top: 20px; /* Reduced from 30px */
            width: 100%; /* Ensure grid takes full width */
            box-sizing: border-box; /* Include padding in width calculation */
        }
        
        .grid-item {
            position: relative;
            min-height: 200px;
            transform: translateY(50px);
            opacity: 0;
            transition: all 0.9s cubic-bezier(0.23, 1, 0.32, 1);
            display: flex;
            flex-direction: column;
        }
        
        .section.active .grid-item {
            transform: translateY(0);
            opacity: 1;
            transition-delay: calc(var(--delay) * 0.15s);
        }
        
        .glowing-text {
            position: relative;
            display: inline-block;
            color: #fff;
            text-shadow: 0 0 10px rgba(255, 255, 255, 0.8);
            padding: 0 5px;
        }
        
        .glowing-text:after {
            content: '';
            position: absolute;
            width: 0;
            height: 1px;
            bottom: 0;
            left: 0;
            background: linear-gradient(90deg, transparent, #a0a0ff, transparent);
            transition: width 0.5s ease;
        }
        
        .glowing-text:hover:after {
            width: 100%;
        }
        
        .text-reveal {
            position: relative;
            overflow: hidden;
        }
        
        .text-reveal:after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, #000, transparent);
            animation: text-reveal 1.5s forwards;
            animation-delay: calc(var(--delay) * 0.3s);
        }
        
        @keyframes text-reveal {
            0% {
                left: 0;
                width: 100%;
            }
            100% {
                left: 100%;
                width: 0;
            }
        }
        
        h1 {
            font-size: clamp(2.5rem, 5vw, 4.5rem); /* Responsive font size */
            margin: 0 0 10px 0; /* Added bottom margin */
            letter-spacing: 10px;
            text-transform: uppercase;
            font-weight: 200;
            text-shadow: 0 0 20px rgba(160, 160, 255, 0.5);
            line-height: 1.2;
            text-align: center;
            opacity: 0.9;
            background: linear-gradient(90deg, #fff, #a0a0ff, #fff);
            background-size: 200% auto;
            background-clip: text;
            -webkit-background-clip: text;
            color: transparent;
            animation: shine 8s linear infinite;
        }
        
        @keyframes shine {
            to {
                background-position: 200% center;
            }
        }
        
        .terminal-box {
            background: rgba(10, 10, 25, 0.75);
            border: 1px solid rgba(160, 160, 255, 0.3);
            border-radius: 5px;
            padding: 20px;
            font-family: 'Space Mono', monospace;
            color: #a0a0ff;
            max-width: 100%;
            position: relative;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.5), 0 0 30px rgba(160, 160, 255, 0.2);
            transform: perspective(500px) rotateX(5deg);
            transition: all 0.3s ease;
            backdrop-filter: blur(6px);
            z-index: 2; /* Ensure terminal boxes appear above constellation */
        }
        
        .terminal-box:hover {
            transform: perspective(500px) rotateX(0);
            border-color: rgba(160, 160, 255, 0.6);
            box-shadow: 0 5px 25px rgba(0, 0, 0, 0.5), 0 0 40px rgba(160, 160, 255, 0.3);
        }
        
        .terminal-box:before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 30px;
            background: rgba(160, 160, 255, 0.1);
            border-bottom: 1px solid rgba(160, 160, 255, 0.2);
            display: flex;
            align-items: center;
            padding-left: 10px;
        }
        
        .terminal-content {
            margin-top: 15px;
            line-height: 1.6;
        }
        
        .terminal-tag {
            color: #7a7aea;
        }
        
        .terminal-command {
            color: #64ff64;
        }
        
        .terminal-string {
            color: #ff9e64;
        }
        
        .terminal-comment {
            color: #626262;
            font-style: italic;
        }
        
        .terminal-output {
            color: #bababa;
            margin-left: 20px;
        }
        
        .blink {
            animation: blink 1s step-end infinite;
            margin-left: 5px;
        }
        
        @keyframes blink {
            50% { opacity: 0; }
        }
        
        .constellation {
            position: absolute; /* Changed from relative to absolute */
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            margin-bottom: 0; /* Removed margin */
            opacity: 0.5; /* Reduced opacity */
            z-index: 1; /* Lower z-index than terminal boxes */
            pointer-events: none; /* Allow clicks to pass through */
        }
        
        .star-point {
            position: absolute;
            width: 3px;
            height: 3px;
            border-radius: 50%;
            background-color: #fff;
            box-shadow: 0 0 8px rgba(160, 160, 255, 0.8);
            animation: star-pulse 3s infinite;
            z-index: 1;
        }
        
        .constellation-line {
            position: absolute;
            height: 1px;
            background: linear-gradient(90deg, transparent, rgba(160, 160, 255, 0.5), transparent);
            transform-origin: left center;
            z-index: 0;
            opacity: 0.6;
        }
        
        @keyframes star-pulse {
            0%, 100% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.5); opacity: 0.7; }
        }
        
        .mystery-text {
            position: relative;
            margin: 20px 0; /* Reduced from 30px */
            padding: 15px; /* Reduced from 20px */
            background: rgba(10, 10, 25, 0.7);
            border-radius: 5px;
            border-left: 3px solid #a0a0ff;
            font-style: italic;
            color: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(6px);
            max-width: 800px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            width: 90%; /* Control width for better text display */
            overflow: visible; /* Ensure text doesn't get cut off */
            z-index: 2; /* Ensure text appears above background elements */
            font-size: 0.95rem; /* Slightly reduced font size */
            box-sizing: border-box; /* Include padding in width calculation */
        }
        
        .mystery-text:before {
            content: """;
            font-size: 4em;
            position: absolute;
            top: -20px;
            left: 10px;
            color: rgba(160, 160, 255, 0.3);
        }
        
        .mystery-text:after {
            content: """;
            font-size: 4em;
            position: absolute;
            bottom: -60px;
            right: 10px;
            color: rgba(160, 160, 255, 0.3);
        }
        
        .skill {
            display: inline-block;
            padding: 4px 12px;
            margin: 4px;
            border-radius: 20px;
            font-size: 0.8rem;
            color: #d4d4ff;
            border: 1px solid rgba(160, 160, 255, 0.3);
            background-color: rgba(160, 160, 255, 0.15);
            transition: all 0.3s ease;
        }
        
        .skill:hover {
            background-color: rgba(160, 160, 255, 0.3);
            transform: translateY(-2px);
        }
        
        .highlight {
            color: #a0a0ff;
            font-weight: normal;
        }
        
        .project-link {
            text-decoration: none;
            color: #a0a0ff;
            display: inline-block;
            padding: 5px 15px;
            border: 1px solid rgba(160, 160, 255, 0.3);
            border-radius: 20px;
            margin-top: 15px;
            transition: all 0.3s ease;
            font-size: 0.9rem;
        }
        
        .project-link:hover {
            background: rgba(160, 160, 255, 0.1);
            border-color: rgba(160, 160, 255, 0.6);
        }
        
        /* Navigation dots */
        .navigation {
            position: fixed;
            right: 30px;
            top: 50%;
            transform: translateY(-50%);
            z-index: 100;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        .nav-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background-color: rgba(255, 255, 255, 0.3);
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }
        
        .nav-dot:before {
            content: attr(data-label);
            position: absolute;
            right: 25px;
            top: 50%;
            transform: translateY(-50%);
            color: rgba(255, 255, 255, 0.5);
            font-size: 0.8rem;
            white-space: nowrap;
            opacity: 0;
            transition: opacity 0.3s;
        }
        
        .nav-dot:hover:before {
            opacity: 1;
        }
        
        .nav-dot.active {
            background-color: white;
            box-shadow: 0 0 10px white;
        }
        
        .scroll-progress {
            position: fixed;
            top: 0;
            left: 0;
            width: 0%;
            height: 2px;
            background: linear-gradient(90deg, #a0a0ff, white);
            z-index: 100;
            transition: width 0.1s;
        }
        
        .scroll-indicator {
            position: fixed;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 0.9rem;
            letter-spacing: 2px;
            text-transform: uppercase;
            opacity: 0.7;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { opacity: 0.3; }
            50% { opacity: 0.8; }
            100% { opacity: 0.3; }
        }
        
        .contact-button {
            display: inline-block;
            margin-top: 30px;
            padding: 10px 25px;
            background: rgba(10, 10, 25, 0.7);
            border: 1px solid rgba(160, 160, 255, 0.6);
            color: #fff;
            text-decoration: none;
            font-family: 'Space Mono', monospace;
            letter-spacing: 2px;
            border-radius: 30px;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            z-index: 1;
            text-transform: uppercase;
            font-size: 0.9rem;
        }
        
        .contact-button:before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(160, 160, 255, 0.3), transparent);
            transition: all 0.6s ease;
            z-index: -1;
        }
        
        .contact-button:hover:before {
            left: 100%;
        }
        
        .contact-button:hover {
            box-shadow: 0 0 15px rgba(160, 160, 255, 0.5);
            border-color: rgba(160, 160, 255, 0.8);
        }
        
        @import url('https://fonts.googleapis.com/css2?family=Space+Mono:wght@400;700&display=swap');
        
        /* Add media queries for better responsiveness */
        @media screen and (max-width: 768px) {
            .content-grid {
                grid-template-columns: 1fr;
            }
            
            h1 {
                letter-spacing: 5px;
            }
            
            .mystery-text {
                width: 95%;
                padding: 12px;
            }
        }
    </style>
</head>
<body>
    <!-- Scroll progress indicator -->
    <div class="scroll-progress" id="scroll-progress"></div>
    
    <!-- Navigation dots -->
    <div class="navigation">
        <div class="nav-dot active" data-section="0" data-label="Identity"></div>
        <div class="nav-dot" data-section="1" data-label="Experience"></div>
        <div class="nav-dot" data-section="2" data-label="Creations"></div>
        <div class="nav-dot" data-section="3" data-label="Connection"></div>
    </div>
    
    <!-- Content sections -->
    <section class="section active" id="section0" data-depth="0">
        <h1>Otso Veisterä</h1>
        
        <div class="mystery-text text-reveal" style="--delay: 1">
            <span class="highlight">Explorer of digital frontiers.</span> Creating solutions at the intersection of science and code. Fluent in Finnish and English (C2), mathematics and machine learning.
        </div>
        
        <div class="content-grid">
            <div class="grid-item" style="--delay: 2">
                <div class="terminal-box">
                    <div class="terminal-content">
                        <span class="terminal-command">$ whoami</span><br>
                        <span class="terminal-output">software_developer & student</span><br><br>
                        
                        <span class="terminal-command">$ cat skills.txt</span><br>
                        <span class="terminal-output">
                            <span class="skill">Programming</span>
                            <span class="skill">Machine Learning</span>
                            <span class="skill">Python</span>
                            <span class="skill">Problem Solving</span>
                            <span class="skill">Rust</span>
                        </span><br><br>
                        
                        <span class="terminal-command">$ echo $achievements</span><br>
                        <span class="terminal-output">
                            - Coder of The Year<br>
                            - Young Innovator<br>
                            - Best Physics Report in Finland<br>
                        </span><br>
                        
                        <span class="terminal-comment">// Constantly exploring new technologies</span><br>
                        <span class="terminal-command">$ find . -name "curiosity"</span><span class="blink">_</span>
                    </div>
                </div>
            </div>
            
            <div class="grid-item" style="--delay: 3">
                <!-- Moved constellation inside terminal box for better layout -->
                <div class="terminal-box">
                    <div class="constellation" id="constellation"></div>
                    <div class="terminal-content">
                        <span class="terminal-tag">&lt;approach&gt;</span><br>
                        <span class="terminal-output">
                            I combine analytical thinking with creative problem-solving, seeking elegant and efficient solutions.
                        </span><br>
                        <span class="terminal-tag">&lt;/approach&gt;</span><br><br>
                        
                        <span class="terminal-tag">&lt;philosophy&gt;</span><br>
                        <span class="terminal-output">
                            Technology should solve real problems, not just exist for its own sake.
                        </span><br>
                        <span class="terminal-tag">&lt;/philosophy&gt;</span><br><br>
                        
                        <span class="terminal-string">"Knowledge is assembling pieces of a puzzle you've never seen completed."</span>
                    </div>
                </div>
            </div>
        </div>
        
        <a href="#" class="contact-button" onclick="scrollToSection(3); return false;">Discover More</a>
    </section>
    
    <section class="section" id="section1" data-depth="1">
        <h1>Experience</h1>
        
        <div class="mystery-text text-reveal" style="--delay: 1">
            <span class="highlight">Translating concepts into reality.</span> From AI development to teaching the next generation of coders, each experience has been a step toward mastery.
        </div>
        
        <div class="content-grid">
            <div class="grid-item" style="--delay: 2">
                <div class="terminal-box">
                    <div class="terminal-content">
                        <span class="terminal-command">$ cat experience.log | head</span><br><br>
                        
                        <span class="terminal-tag">[Planmeca]</span> <span class="terminal-comment">// Jun-Jul 2024</span><br>
                        <span class="terminal-output">
                            Developed AI for 3D medical imaging<br>
                            PyTorch-based segmentation model<br>
                            Improved diagnostic workflows
                        </span><br>
                        
                        <span class="terminal-tag">[4H Federation]</span> <span class="terminal-comment">// Jul 2023</span><br>
                        <span class="terminal-output">
                            Led youth development programs<br>
                            Created engaging learning experiences
                        </span><br>
                        
                        <span class="terminal-tag">[City of Espoo]</span> <span class="terminal-comment">// Jun 2022</span><br>
                        <span class="terminal-output">
                            Taught programming through Minecraft<br>
                            Translated complex concepts for young minds
                        </span><br>
                    </div>
                </div>
            </div>
            
            <div class="grid-item" style="--delay: 3">
                <div class="terminal-box">
                    <div class="terminal-content">
                        <span class="terminal-command">$ grep -A 3 "achievement" career.json</span><br>
                        <span class="terminal-output">
                            {<br>
                            &nbsp;&nbsp;"highlight": "33 bugs identified in one week",<br>
                            &nbsp;&nbsp;"location": "Planmeca internship",<br>
                            &nbsp;&nbsp;"skill": "Exceptional attention to detail"<br>
                            }<br><br>
                            {<br>
                            &nbsp;&nbsp;"highlight": "Electronics & microcontroller development",<br>
                            &nbsp;&nbsp;"location": "Aalto Design Factory",<br>
                            &nbsp;&nbsp;"skill": "Hardware-software integration"<br>
                            }<br>
                        </span><br>
                        
                        <span class="terminal-command">$ git log --author="Otso" --pretty=format:"%h - %s"</span><span class="blink">_</span>
                    </div>
                </div>
            </div>
        </div>
    </section>
    
    <section class="section" id="section2" data-depth="2">
        <h1>Projects</h1>
        
        <div class="mystery-text text-reveal" style="--delay: 1">
            <span class="highlight">Ideas materialized through code.</span> Each project represents a challenge overcome, a problem solved, and knowledge gained.
        </div>
        
        <div class="content-grid">
            <div class="grid-item" style="--delay: 2">
                <div class="terminal-box">
                    <div class="terminal-content">
                        <span class="terminal-tag">[LatexToCalc]</span><br>
                        <span class="terminal-output">
                            Translating mathematical language across platforms<br>
                            <br>
                            <span class="terminal-comment">// Backend</span><br>
                            Flask-based translation server<br>
                            REST API with multi-endpoint architecture<br>
                            CI/CD with GitHub Actions<br>
                            <br>
                            <span class="terminal-comment">// Frontend</span><br>
                            Chrome extension for seamless integration<br>
                            User-friendly interface for formula conversion
                        </span><br>
                        
                        <span class="terminal-string">
                            "Making complex expressions accessible everywhere."
                        </span><br>
                    </div>
                </div>
            </div>
            
            <div class="grid-item" style="--delay: 3">
                <div class="terminal-box">
                    <div class="terminal-content">
                        <span class="terminal-tag">[Rustful Raytracer]</span><br>
                        <span class="terminal-output">
                            High-performance graphics engine built in Rust<br>
                            <br>
                            <span class="terminal-comment">// Features</span><br>
                            Multi-threaded rendering<br>
                            Realistic material simulation<br>
                            Reflection & refraction physics<br>
                            Mathematical optics modeling<br>
                        </span><br>
                        
                        <span class="terminal-command">$ ./measure_performance.sh</span><br>
                        <span class="terminal-output">
                            Render time: [██████████] 100%<br>
                            Quality: Photorealistic<br>
                            Status: Optimized
                        </span><br>
                        
                        <a href="#" class="project-link">View Projects</a>
                    </div>
                </div>
            </div>
        </div>
    </section>
    
    <section class="section" id="section3" data-depth="3">
        <h1>Connect</h1>
        
        <div class="mystery-text text-reveal" style="--delay: 1">
            <span class="highlight">The journey continues.</span> Currently studying in the selective Data (LuMa) program at Otaniemen Lukio, exploring advanced mathematics and physics while leading multiple student initiatives.
        </div>
        
        <div class="content-grid">
            <div class="grid-item" style="--delay: 2">
                <div class="terminal-box">
                    <div class="terminal-content">
                        <span class="terminal-command">$ cat education.md</span><br>
                        <span class="terminal-output">
                            <span class="terminal-tag"># Otaniemen Lukio (2023-2026)</span><br>
                            Data (Natural Sciences & Mathematics) program<br>
                            Selected from hundreds of applicants<br><br>
                            
                            <span class="terminal-comment">## Leadership Roles</span><br>
                            - Vice President & Website Editor, Datat Ry Board<br>
                            - Website Manager, Olarfest Board<br>
                            - Technician, Audio Visual Team<br>
                            - Trailer Lead & Scriptwriter, Dataleffa<br>
                        </span><br>
                        
                        <span class="terminal-command">$ echo $future_interests</span><br>
                        <span class="terminal-output">
                            AI Research, Computer Vision, Physics Simulation
                        </span>
                    </div>
                </div>
            </div>
            
            <div class="grid-item" style="--delay: 3">
                <div class="terminal-box">
                    <div class="terminal-content">
                        <span class="terminal-command">$ whois otso</span><br>
                        <span class="terminal-output">
                            <span class="terminal-comment">// Contact Information</span><br>
                            Email: <a href="mailto:otso.veistera@gmail.com" class="glowing-text">otso.veistera@gmail.com</a><br>
                            LinkedIn: <a href="https://www.linkedin.com/in/otso-veistera" class="glowing-text" target="_blank">otso-veistera</a><br>
                            Location: Espoo, Finland<br><br>
                        </span>
                        
                        <span class="terminal-string">"The most interesting challenges are yet to come."</span><br><br>
                        
                        <span class="terminal-command">$ ssh future@otso.connect</span><br>
                        <span class="terminal-output">
                            Establishing connection...<span class="blink">_</span>
                        </span>
                    </div>
                </div>
            </div>
        </div>
        
        <a href="https://www.linkedin.com/in/otso-veistera" class="contact-button" target="_blank">Connect on LinkedIn</a>
    </section>
    
    <div class="scroll-indicator">Scroll to explore</div>
    
    <script>
        // Scene setup
        let renderer, scene, camera;
        let particles = [];
        let starGroups = [];
        
        // Scroll variables
        let scrollY = 0;
        let targetScrollY = 0;
        let currentSection = 0;
        let targetSection = 0;
        
        // Section positions in 3D space - distribute more evenly
        const sectionCoordinates = [
            { x: 0, y: 0, z: 0 },
            { x: 150, y: 30, z: -150 },
            { x: -120, y: -40, z: -300 },
            { x: 0, y: 0, z: -450 }
        ];
        
        // Initialize with performance options
        function init() {
            // Create constellation effect
            createConstellation();
            
            // Create renderer with performance optimizations
            renderer = new THREE.WebGLRenderer({ 
                antialias: false, // Disable antialiasing for performance
                alpha: true,
                powerPreference: "high-performance",
                precision: "mediump" // Use medium precision for better performance
            });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.setPixelRatio(Math.min(window.devicePixelRatio, 1.5)); // Limit pixel ratio
            document.body.appendChild(renderer.domElement);
            
            // Create scene
            scene = new THREE.Scene();
            
            // Create camera with adjusted parameters
            camera = new THREE.PerspectiveCamera(60, window.innerWidth / window.innerHeight, 0.1, 2000);
            camera.position.set(0, 0, 40); // Pull camera back for wider view
            
            // Create particles
            createParticles();
            
            // Setup event listeners
            setupEventListeners();
            
            // Start animation loop with throttling for performance
            animateWithThrottling();
            
            // Initial section activation
            updateSectionVisibility();
            
            // Make sure text is visible initially
            ensureTextVisibility();
        }
        
        // Create constellation visualization with better positioning
        function createConstellation() {
            const constellation = document.getElementById('constellation');
            if (!constellation) return;
            
            // Clear any existing elements
            constellation.innerHTML = '';
            
            // Create stars
            const starCount = 12; // Reduced number of stars
            const stars = [];
            
            for (let i = 0; i < starCount; i++) {
                const star = document.createElement('div');
                star.className = 'star-point';
                
                // Random position within the container but avoid center area
                let left, top;
                
                // Distribute stars more towards edges to avoid center text
                if (Math.random() < 0.5) {
                    left = Math.random() * 30 + 5; // Left side
                } else {
                    left = Math.random() * 30 + 65; // Right side
                }
                
                // Top or bottom positioning
                if (Math.random() < 0.5) {
                    top = Math.random() * 30 + 5; // Top area
                } else {
                    top = Math.random() * 30 + 65; // Bottom area
                }
                
                star.style.left = `${left}%`;
                star.style.top = `${top}%`;
                star.style.animationDelay = `${Math.random() * 2}s`;
                
                constellation.appendChild(star);
                stars.push({ left, top, element: star });
            }
            
            // Create fewer lines between stars
            for (let i = 0; i < stars.length - 1; i += 2) { // Skip every other star for fewer lines
                if (Math.random() < 0.5) { // 50% chance to create a line
                    const star1 = stars[i];
                    const star2 = stars[i + 1];
                    
                    const line = document.createElement('div');
                    line.className = 'constellation-line';
                    
                    // Position and rotate the line
                    const dx = star2.left - star1.left;
                    const dy = star2.top - star1.top;
                    const distance = Math.sqrt(dx * dx + dy * dy);
                    const angle = Math.atan2(dy, dx);
                    
                    line.style.width = `${distance}%`;
                    line.style.left = `${star1.left}%`;
                    line.style.top = `${star1.top}%`;
                    line.style.transform = `rotate(${angle}rad)`;
                    
                    constellation.appendChild(line);
                }
            }
        }
        
        // Create space particles distributed along the trajectory
        function createParticles() {
            // Create different particle groups with fewer particles for better performance
            createStarsAlongPath(3000, 0.3, 0.002); // Distant stars
            createStarsAlongPath(1500, 0.5, 0.003); // Mid-range stars
            createStarsAlongPath(500, 0.7, 0.004);  // Closer stars
        }
        
        // Create stars distributed along the camera path
        function createStarsAlongPath(count, size, speed) {
            // Using a circle texture for stars
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            
            canvas.width = 32; // Reduced from 64
            canvas.height = 32; // Reduced from 64
            
            // Create a radial gradient for a soft star appearance
            const gradient = ctx.createRadialGradient(16, 16, 0, 16, 16, 16);
            gradient.addColorStop(0, 'rgba(255, 255, 255, 1)');
            gradient.addColorStop(0.3, 'rgba(255, 255, 255, 0.8)');
            gradient.addColorStop(1, 'rgba(255, 255, 255, 0)');
            
            ctx.fillStyle = gradient;
            ctx.beginPath();
            ctx.arc(16, 16, 16, 0, Math.PI * 2);
            ctx.fill();
            
            // Create texture from canvas
            const texture = new THREE.CanvasTexture(canvas);
            
            // Create geometry for stars
            const geometry = new THREE.BufferGeometry();
            const positions = new Float32Array(count * 3);
            
            // Distribute stars along all paths between section coordinates
            for (let i = 0; i < count; i++) {
                const pathIndex = Math.floor(Math.random() * (sectionCoordinates.length - 1));
                const start = sectionCoordinates[pathIndex];
                const end = sectionCoordinates[pathIndex + 1];
                
                // Random position between start and end points
                const t = Math.random();
                const x = start.x + (end.x - start.x) * t;
                const y = start.y + (end.y - start.y) * t;
                const z = start.z + (end.z - start.z) * t;
                
                // Add some random offset
                const offset = 200;
                positions[i * 3] = x + (Math.random() - 0.5) * offset;
                positions[i * 3 + 1] = y + (Math.random() - 0.5) * offset;
                positions[i * 3 + 2] = z + (Math.random() - 0.5) * offset;
            }
            
            geometry.setAttribute('position', new THREE.BufferAttribute(positions, 3));
            
            // Create particles with optimized material
            const material = new THREE.PointsMaterial({
                size: size,
                map: texture,
                transparent: true,
                opacity: 0.7,
                depthWrite: false,
                blending: THREE.AdditiveBlending,
                color: 0xffffff
            });
            
            const particleSystem = new THREE.Points(geometry, material);
            scene.add(particleSystem);
            
            // Store particle system and its speed for animation
            particles.push({ system: particleSystem, speed: speed });
        }

        // Setup event listeners
        function setupEventListeners() {
            // Handle window resize
            window.addEventListener('resize', () => {
                camera.aspect = window.innerWidth / window.innerHeight;
                camera.updateProjectionMatrix();
                renderer.setSize(window.innerWidth, window.innerHeight);
            });
            
            // Handle scroll events with fixed section visibility
            window.addEventListener('scroll', () => {
                // Get scroll position
                scrollY = window.scrollY;
                const maxScroll = document.body.scrollHeight - window.innerHeight;
                const scrollPercent = (scrollY / maxScroll) * 100;
                
                // Update scroll progress indicator
                document.getElementById('scroll-progress').style.width = `${scrollPercent}%`;
                
                // Calculate current section based on scroll position
                // Use a more reliable method to determine current section
                const windowHeight = window.innerHeight;
                targetSection = Math.round(scrollY / windowHeight);
                
                // Clamp to valid section range
                targetSection = Math.max(0, Math.min(3, targetSection));
                
                // Update navigation dots
                updateNavigation();
                
                // Update section visibility - show one section at a time
                updateSectionVisibility();
                
                // Hide scroll indicator after scrolling begins
                if (scrollY > 100) {
                    document.querySelector('.scroll-indicator').style.opacity = '0';
                }
            });
            
            // Handle navigation dot clicks
            document.querySelectorAll('.nav-dot').forEach(dot => {
                dot.addEventListener('click', () => {
                    const sectionIndex = parseInt(dot.dataset.section);
                    scrollToSection(sectionIndex);
                });
            });
            
            // Update section visibility on page load and resize
            window.addEventListener('load', updateSectionVisibility);
            window.addEventListener('resize', updateSectionVisibility);
        }
        
        // Update navigation dots
        function updateNavigation() {
            document.querySelectorAll('.nav-dot').forEach((dot, index) => {
                dot.classList.toggle('active', index === targetSection);
            });
        }
        
        // Update section visibility with optimized DOM operations
        function updateSectionVisibility() {
            if (window._lastActiveSection === targetSection) return;
            
            document.querySelectorAll('.section').forEach((section, index) => {
                if (index === targetSection) {
                    section.classList.add('active');
                } else {
                    section.classList.remove('active');
                }
            });
            
            window._lastActiveSection = targetSection;
        }
        
        // Scroll to specific section
        function scrollToSection(index) {
            // Scroll to section
            window.scrollTo({
                top: index * window.innerHeight,
                behavior: 'smooth'
            });
        }
        
        // Throttled animation for better performance
        let lastTime = 0;
        const frameInterval = 1000 / 45; // Target ~45 FPS instead of 60+
        
        function animateWithThrottling(currentTime = 0) {
            requestAnimationFrame(animateWithThrottling);
            
            // Skip frames to maintain performance
            const elapsed = currentTime - lastTime;
            if (elapsed < frameInterval) return;
            
            // Cap delta time to avoid large jumps after tab switching
            lastTime = currentTime - (elapsed % frameInterval);
            
            // Perform animation
            moveCamera();
            addTwinkleEffect();
            renderer.render(scene, camera);
        }
        
        // Smooth camera movement with improved transitions
        function moveCamera() {
            // Interpolate between current section and target section
            currentSection += (targetSection - currentSection) * 0.05;
            
            // Calculate interpolated position between section coordinates
            const index = Math.floor(currentSection);
            const nextIndex = Math.min(3, index + 1);
            const fraction = currentSection - index;
            
            // Get current and next section coordinates
            const currentCoord = sectionCoordinates[index];
            const nextCoord = sectionCoordinates[nextIndex];
            
            // Interpolate between current and next coordinates
            const targetX = currentCoord.x + (nextCoord.x - currentCoord.x) * fraction;
            const targetY = currentCoord.y + (nextCoord.y - currentCoord.y) * fraction;
            const targetZ = currentCoord.z + (nextCoord.z - currentCoord.z) * fraction;
            
            // Move camera smoothly to target position
            camera.position.x += (targetX - camera.position.x) * 0.05;
            camera.position.y += (targetY - camera.position.y) * 0.05;
            camera.position.z += (targetZ - camera.position.z) * 0.05;
            
            // Always look slightly ahead for smoother transitions
            camera.lookAt(targetX, targetY, targetZ - 100);
            
            // Rotate camera slightly based on mouse position for subtle movement
            rotateCamera();
        }
        
        // Add subtle camera rotation with reduced intensity
        let mouseX = 0;
        let mouseY = 0;
        document.addEventListener('mousemove', (event) => {
            mouseX = (event.clientX / window.innerWidth) * 2 - 1;
            mouseY = (event.clientY / window.innerHeight) * 2 - 1;
        });
        
        function rotateCamera() {
            // Reduced intensity of movement (from 5 to 3, and 0.01 to 0.005)
            camera.position.x += (mouseX * 3 - camera.position.x) * 0.005;
            camera.position.y += (-mouseY * 3 - camera.position.y) * 0.005;
            
            // Always look at the target
            camera.lookAt(camera.position.x, camera.position.y, camera.position.z - 100);
        }
        
        // Optimize twinkle effect for better performance
        function addTwinkleEffect() {
            particles.forEach(particle => {
                const { system, speed } = particle;
                
                // Simple rotation instead of updating every particle position
                system.rotation.z += speed * 0.01;
                
                // Only update a small subset of particles each frame
                if (Math.random() > 0.7) {
                    const positions = system.geometry.attributes.position.array;
                    const updateLimit = Math.min(100, positions.length / 3);
                    
                    for (let i = 0; i < updateLimit; i++) {
                        const index = Math.floor(Math.random() * (positions.length / 3)) * 3;
                        positions[index + 2] += speed * 5;
                        
                        if (positions[index + 2] > 20) {
                            positions[index + 2] = -800 - Math.random() * 200;
                        }
                    }
                    
                    system.geometry.attributes.position.needsUpdate = true;
                }
            });
        }
        
        // Handle window resize with debouncing
        let resizeTimeout;
        window.addEventListener('resize', () => {
            clearTimeout(resizeTimeout);
            resizeTimeout = setTimeout(() => {
                camera.aspect = window.innerWidth / window.innerHeight;
                camera.updateProjectionMatrix();
                renderer.setSize(window.innerWidth, window.innerHeight);
            }, 250);
        });

        // Ensure elements are sized correctly for visibility
        function ensureTextVisibility() {
            document.querySelectorAll('.mystery-text').forEach(el => {
                el.style.maxHeight = 'none';
                el.style.height = 'auto';
            });
            
            // Set proper height for grid items to ensure content is visible
            document.querySelectorAll('.grid-item').forEach(item => {
                item.style.minHeight = 'auto';
            });
        }
        
        // Initiate the scene once the window is loaded
        window.addEventListener('load', init);
    </script>
</body>
</html>
